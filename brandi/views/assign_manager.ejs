<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="no-js"> <!--<![endif]-->

<% include head.ejs %>

<body id="body" ng-app="assignManager">
  <% include nav_bar.ejs %>

  <section id="assign_manager" class="works clearfix" ng-controller="populateDepartments">
    <div class="container">
      <table class="table table-bordered">
        <thead>
          <th>Department</th>
          <th>Manager name</th>
          <th>Manager SSN</th>
        </thead>
        <tbody>
        <%# <option ng-repeat="x in departments">{{x.dname}}</option>%>
        <% for (di in departments) {
            var dept_manager_flag = false;%>
          <tr>
            <td>
              <%=departments[di].dname%>
            </td>
              <% for (mi in managers){
                  if(managers[mi].dno === departments[di].dno && managers[mi].mname != ""){
                    dept_manager_flag = true;%>
                    <td>
                    <input type="text" name="<%= departments[di].dname %>" value="<%= managers[mi].mname %>">
                    </td>
                    <td>
                    <label><%= managers[mi].ssn %></label>
                    </td>
                  <%}
                }
                if(dept_manager_flag==false){ %>
                  <td>
                  <input type="text" name="<%= departments[di].dname %>" >
                  </td>
                  <td>
                  </td>
                <%}%>
          </tr>
        <% } %>
      </tbody>
      </table>
    </div>
  </section>

  <%# <script>

  var app = angular.module('assignManager', []);
  app.controller('populateDepartments', function ($scope, $http){
    $http.post("/get_departments")
    .then(function (response) {
      $scope.departments = response.data;
      console.log("Departments:");
      console.log($scope.departments);
    });
  });
  </script>%>
</body>
